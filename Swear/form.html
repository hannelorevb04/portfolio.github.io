<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bestelling Plaatsen</title>
  </head>
  <body>
    <div>
      <h2>Bestelling Plaatsen</h2>
      <form id="order-form">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required />

        <label for="phone">Telefoonnummer:</label>
        <input type="tel" id="phone" name="phone" required />

        <h3>Adresgegevens:</h3>
        <label for="street">Straat:</label>
        <input type="text" id="street" name="street" required />

        <label for="city">Stad:</label>
        <input type="text" id="city" name="city" required />

        <label for="zip">Postcode:</label>
        <input type="text" id="zip" name="zip" required />

        <label for="country">Land:</label>
        <input type="text" id="country" name="country" required />

        <button type="submit">Bestelling Plaatsen</button>
      </form>
    </div>

    <script>
      // Voeg hier de JavaScript toe
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get("productId");

      if (!productId) {
        alert("Product-ID ontbreekt. Keer terug naar de configurator.");
        window.location.href = "/index.html";
      }

      const form = document.getElementById("order-form");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        const formData = new FormData(form);
        const orderData = {
          productId,
          clientDetails: {
            email: formData.get("email"),
            phone: formData.get("phone"),
            address: {
              street: formData.get("street"),
              city: formData.get("city"),
              zip: formData.get("zip"),
              country: formData.get("country"),
            },
          },
          totalPrice: 139.99,
        };

        try {
          const response = await fetch(
            "https://sneaker-configurator-api-ak6n.onrender.com/api/v1/orders",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(orderData),
            }
          );

          if (!response.ok) {
            throw new Error("Fout bij het opslaan van de bestelling.");
          }

          alert("Uw bestelling is succesvol geplaatst!");
          window.location.href = "/thank-you.html";
        } catch (error) {
          console.error("Fout bij het opslaan van de bestelling:", error);
          alert(
            "Er is een fout opgetreden bij het plaatsen van uw bestelling."
          );
        }
      });
    </script>
  </body>
</html>
